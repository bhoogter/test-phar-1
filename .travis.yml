language: php
branches:
  only:
    - master
    - /^.*[[:digit:]]+\.[[:digit:]]+\.[[:digit:]]+.*$/

php:
  - '7.2'
script: phpunit --bootstrap src/autoload.php --test-suffix '-test.php,Test.php,.phpt' tests
notifications:
  email: false

before_deploy:
  - composer phar:install-tools
  - composer install --prefer-dist --no-dev --no-interaction
  - php box.phar build
deploy:
  - provider: releases
    skip_cleanup: true
    file: test-phar-1.phar
    #    all_branches: true
    api_key:
      secure: a724d2a2b485713632a39b007b2771bfa9842907
    on:
      repo: bhoogter/test-phar-1
      tags: true
